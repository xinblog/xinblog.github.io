<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="keywords" content="Hexo Theme Keep">
    <meta name="description" content="Hexo Theme Keep">
    <meta name="author" content="周瑜">
    
    <title>
        
            apollo 学习记录 |
        
        xinblog
    </title>
    <link rel="stylesheet" href="/css/style.css">
    <link rel="shortcut icon" href="/images/logo.svg">
    <link rel="stylesheet" href="/css/font-awesome.min.css">
    <script id="hexo-configurations">
    let KEEP = window.KEEP || {};
    KEEP.hexo_config = {"hostname":"yoursite.com","root":"/","language":"en"};
    KEEP.theme_config = {"toc":{"enable":false,"number":false,"expand_all":false,"init_open":false},"style":{"primary_color":"#0066CC","avatar":"/images/avatar.svg","favicon":"/images/logo.svg","article_img_align":"left","left_side_width":"260px","content_max_width":"920px","hover":{"shadow":true,"scale":false},"first_screen":{"enable":true,"background_img":"/images/bg.svg","description":"Keep writing and Keep loving."},"scroll":{"progress_bar":{"enable":true},"percent":{"enable":true}}},"local_search":{"enable":false,"preload":false},"code_copy":{"enable":false,"style":"default"},"pjax":{"enable":false},"lazyload":{"enable":false},"version":"3.4.1"};
    KEEP.language_ago = {"second":"%s seconds ago","minute":"%s minutes ago","hour":"%s hours ago","day":"%s days ago","week":"%s weeks ago","month":"%s months ago","year":"%s years ago"};
  </script>
<meta name="generator" content="Hexo 5.4.0"></head>


<body>
<div class="progress-bar-container">
    
        <span class="scroll-progress-bar"></span>
    

    
</div>


<main class="page-container">

    

    <div class="page-main-content">

        <div class="page-main-content-top">
            <header class="header-wrapper">

    <div class="header-content">
        <div class="left">
            <a class="logo-title" href="/">
                xinblog
            </a>
        </div>

        <div class="right">
            <div class="pc">
                <ul class="menu-list">
                    
                        <li class="menu-item">
                            <a class=""
                               href="/"
                            >
                                HOME
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/archives"
                            >
                                ARCHIVES
                            </a>
                        </li>
                    
                    
                </ul>
            </div>
            <div class="mobile">
                
                <div class="icon-item menu-bar">
                    <div class="menu-bar-middle"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="header-drawer">
        <ul class="drawer-menu-list">
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/">HOME</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/archives">ARCHIVES</a>
                </li>
            
        </ul>
    </div>

    <div class="window-mask"></div>

</header>


        </div>

        <div class="page-main-content-middle">

            <div class="main-content">

                
                    <div class="fade-in-down-animation">
    <div class="article-content-container">

        <div class="article-title">
            <span class="title-hover-animation">apollo 学习记录</span>
        </div>

        
            <div class="article-header">
                <div class="avatar">
                    <img src="/images/avatar.svg">
                </div>
                <div class="info">
                    <div class="author">
                        <span class="name">周瑜</span>
                        
                            <span class="author-label">Lv1</span>
                        
                    </div>
                    <div class="meta-info">
                        <div class="article-meta-info">
    <span class="article-date article-meta-item">
        <i class="fas fa-edit"></i>&nbsp;2021-03-15 11:38:55
    </span>
    
    

    
    
    
    
</div>

                    </div>
                </div>
            </div>
        

        <div class="article-content markdown-body">
            <h2 id="Apollo分布式配置中心"><a href="#Apollo分布式配置中心" class="headerlink" title="Apollo分布式配置中心"></a>Apollo分布式配置中心</h2><h4 id="1-Apollo快速开始"><a href="#1-Apollo快速开始" class="headerlink" title="1.Apollo快速开始"></a>1.Apollo快速开始</h4><ul>
<li><p>下载Quick Start安装包</p>
</li>
<li><p>创建ApolloPortalDB和apolloConfigDB数据库</p>
</li>
<li><p>配置数据库连接信息</p>
<figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bat"><span class="hljs-built_in">echo</span><br><br><span class="hljs-built_in">set</span> url=&quot;localhost:<span class="hljs-number">3306</span>&quot;<br><span class="hljs-built_in">set</span> username=&quot;root&quot;<br><span class="hljs-built_in">set</span> password=&quot;<span class="hljs-number">123456</span>&quot;<br><br><span class="hljs-built_in">start</span> &quot;configService&quot; java -Xms256m -Xmx256m -Dapollo_profile=github -Dspring.datasource.url=jdbc:mysql://<span class="hljs-variable">%url%</span>/ApolloConfigDB?characterEncoding=utf8 -Dspring.datasource.username=<span class="hljs-variable">%username%</span> -Dspring.datasource.password=<span class="hljs-variable">%password%</span> -Dlogging.file=.\logs\apollo-configservice.log -jar .\apollo-configservice-<span class="hljs-number">1</span>.<span class="hljs-number">3</span>.<span class="hljs-number">0</span>.jar<br><span class="hljs-built_in">start</span> &quot;adminService&quot; java -Xms256m -Xmx256m -Dapollo_profile=github -Dspring.datasource.url=jdbc:mysql://<span class="hljs-variable">%url%</span>/ApolloConfigDB?characterEncoding=utf8 -Dspring.datasource.username=<span class="hljs-variable">%username%</span> -Dspring.datasource.password=<span class="hljs-variable">%password%</span> -Dlogging.file=.\logs\apollo-adminservice.log -jar .\apollo-adminservice-<span class="hljs-number">1</span>.<span class="hljs-number">3</span>.<span class="hljs-number">0</span>.jar<br><span class="hljs-built_in">start</span> &quot;ApolloPortal&quot; java -Xms256m -Xmx256m -Dapollo_profile=github,auth -Ddev_meta=http://localhost:<span class="hljs-number">8080</span>/ -Dserver.port=<span class="hljs-number">8070</span> -Dspring.datasource.url=jdbc:mysql://<span class="hljs-variable">%url%</span>/ApolloPortalDB?characterEncoding=utf8 -Dspring.datasource.username=<span class="hljs-variable">%username%</span> -Dspring.datasource.password=<span class="hljs-variable">%password%</span> -Dlogging.file=.\logs\apollo-portal.log -jar .\apollo-portal-<span class="hljs-number">1</span>.<span class="hljs-number">3</span>.<span class="hljs-number">0</span>.jar<br></code></pre></td></tr></table></figure>
</li>
<li><p>启动Apollo配置中心，端口不能被占用</p>
<ul>
<li>执行runApollo.bat脚本</li>
<li><img src="/2021/03/15/apollo-md/image-20210311155701217.png" alt="image-20210311155701217"></li>
</ul>
</li>
<li><p>创建一个Apollo项目</p>
</li>
<li><p><img src="/2021/03/15/apollo-md/image-20210311155734407.png" alt="image-20210311155734407"></p>
</li>
<li><p>创建需要的配置</p>
</li>
<li><p><img src="/2021/03/15/apollo-md/image-20210311155841873.png" alt="image-20210311155841873"></p>
</li>
<li><p>创建完成后用Idea测试，创建一个spring boot项目</p>
</li>
<li><p>引入依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.ctrip.framework.apollo<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>apollo-client<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.8.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br></code></pre></td></tr></table></figure>
</li>
<li><p>指定配置项目的id 环境 和地址</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs vm">-Dapp.id&#x3D;apollo-quick -Denv&#x3D;DEV -Ddev_meta&#x3D;http:&#x2F;&#x2F;localhost:8080<br></code></pre></td></tr></table></figure>



</li>
</ul>
<ul>
<li><p>测试类进行测试</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Slf4j</span><br><span class="hljs-meta">@SpringBootTest</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Project7ApplicationTests</span> </span>&#123;<br><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">contextLoads</span><span class="hljs-params">()</span> </span>&#123;<br>        Config appConfig = ConfigService.getAppConfig();  <span class="hljs-comment">//获取配置对象</span><br>       <span class="hljs-comment">//Apollo是热发布的，实时更新，使用方法测试</span><br>        <span class="hljs-keyword">while</span> (<span class="hljs-keyword">true</span>)&#123;<br>            <span class="hljs-keyword">try</span> &#123;<br>                Thread.sleep(<span class="hljs-number">1000</span>);<br>                <span class="hljs-comment">//获取配置信息，第一个参数：配置的key，第二个参数：默认值</span><br>                String sms = appConfig.getProperty(<span class="hljs-string">&quot;sms&quot;</span>, <span class="hljs-keyword">null</span>);<br>                log.info(<span class="hljs-string">&quot;sms: &quot;</span>+sms);<br>            &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>                e.printStackTrace();<br>            &#125;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="2-Apollo核心概念"><a href="#2-Apollo核心概念" class="headerlink" title="2.Apollo核心概念"></a>2.Apollo核心概念</h3><h6 id="1-application-应用"><a href="#1-application-应用" class="headerlink" title="1.application(应用)"></a>1.application(应用)</h6><p>​    就是实际使用配置的应用，Apollo客户端在运行时需要知道当前应用是谁从而可以去获取对应的配置  <strong>关键字：appId</strong></p>
<h6 id="2-environment（环境）"><a href="#2-environment（环境）" class="headerlink" title="2.environment（环境）"></a>2.environment（环境）</h6><p>配置对应的环境，Apollo客户端在运行时需要知道当前应用处于哪个环境，从而可以去获取应用的配置  <strong>关键字：env</strong></p>
<h6 id="3-cluster（集群）"><a href="#3-cluster（集群）" class="headerlink" title="3.cluster（集群）"></a>3.cluster（集群）</h6><p>一个应用下不同实例的分组，比如典型的可以按照数据中心分。把上海机房的应用实例分为一个集群，把北京机房的应用实例分为另一个集群。  <strong>关键字：cluster</strong></p>
<h6 id="4-namespace-命名空间"><a href="#4-namespace-命名空间" class="headerlink" title="4.namespace(命名空间)"></a>4.namespace(命名空间)</h6><p>一个应用下不同配置的分组，可以简单的把namespace类比为文件，不同类型的配置放在不同的文件中，如数据库配置文件，RPC配置文件，应用自身的配置文件等。 <strong>关键字：namespace</strong></p>
<h6 id="他们的关系图："><a href="#他们的关系图：" class="headerlink" title="他们的关系图："></a>他们的关系图：</h6><p><img src="/2021/03/15/apollo-md/image-20210311164008302.png" alt="image-20210311164008302"></p>
</li>
</ul>
<h3 id="3-Apollo项目管理"><a href="#3-Apollo项目管理" class="headerlink" title="3.Apollo项目管理"></a>3.Apollo项目管理</h3><h4 id="1-基础设置"><a href="#1-基础设置" class="headerlink" title="1.基础设置"></a>1.基础设置</h4><ul>
<li><p>添加部门</p>
<ul>
<li>Apollo主页  –&gt;   管理员工具  –&gt;   系统参数</li>
</ul>
<p><img src="/2021/03/15/apollo-md/image-20210311170948744.png" alt="image-20210311170948744"></p>
<ul>
<li><p>查询配置信息：organizations然后在返回的json数据中添加</p>
<p><img src="/2021/03/15/apollo-md/image-20210311171256529.png" alt="image-20210311171256529"></p>
</li>
</ul>
</li>
<li><p>添加用户</p>
</li>
<li><p>Apollo主页  –&gt;   管理员工具  –&gt;   用户管理</p>
</li>
<li><p>删除项目</p>
<ul>
<li>Apollo主页  –&gt;   管理员工具  –&gt;  删除应用，集群</li>
</ul>
</li>
</ul>
<h4 id="2-添加Namespace"><a href="#2-添加Namespace" class="headerlink" title="2.添加Namespace"></a>2.添加Namespace</h4><p><img src="/2021/03/15/apollo-md/image-20210311173549047.png" alt="image-20210311173549047"></p>
<p><img src="/2021/03/15/apollo-md/image-20210311173620947.png" alt="image-20210311173620947"></p>
<ul>
<li><p>快捷导入配置</p>
<p>复制配置放入文本中</p>
<p><img src="/2021/03/15/apollo-md/image-20210311173807720.png" alt="image-20210311173807720"></p>
</li>
<li><p>获取namespace的配置</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Slf4j</span><br><span class="hljs-meta">@SpringBootTest</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Project7ApplicationTests</span> </span>&#123;<br><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">contextLoads</span><span class="hljs-params">()</span> </span>&#123;<br><span class="hljs-comment">//        Config appConfig = ConfigService.getAppConfig();  获取默认namespace下的配置信息</span><br>        <span class="hljs-comment">//获取指定namespace下的配置信息</span><br>        Config appConfig =  ConfigService.getConfig(<span class="hljs-string">&quot;apollo-redis&quot;</span>);<br>        <span class="hljs-keyword">while</span> (<span class="hljs-keyword">true</span>)&#123;<br>            <span class="hljs-keyword">try</span> &#123;<br>                Thread.sleep(<span class="hljs-number">1000</span>);<br>                String sms = appConfig.getProperty(<span class="hljs-string">&quot;spring.redis.host&quot;</span>, <span class="hljs-keyword">null</span>);<br>                log.info(<span class="hljs-string">&quot;spring.redis.host: &quot;</span>+sms);<br>            &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>                e.printStackTrace();<br>            &#125;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h2 id="4-springboot集成Apollo"><a href="#4-springboot集成Apollo" class="headerlink" title="4.springboot集成Apollo"></a>4.springboot集成Apollo</h2><h4 id="1-使用-value注解获取"><a href="#1-使用-value注解获取" class="headerlink" title="1.使用@value注解获取"></a>1.使用@value注解获取</h4><ol>
<li><h5 id="获取默认namespace的值"><a href="#获取默认namespace的值" class="headerlink" title="获取默认namespace的值"></a>获取默认namespace的值</h5></li>
</ol>
<ul>
<li><p>导入依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.ctrip.framework.apollo<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>apollo-client<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.8.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure>
</li>
<li><p>编写Apollo相关的配置</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-string">app.id=apollo-quick</span><br><span class="hljs-string">apollo.meta=http://localhost:8080</span><br></code></pre></td></tr></table></figure>
</li>
<li><p>使用controller进行测试</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><br><span class="hljs-meta">@EnableApolloConfig</span> <span class="hljs-comment">//</span><br><span class="hljs-meta">@RestController</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">apolloController</span> </span>&#123;<br>    <span class="hljs-meta">@Value(&quot;$&#123;mysql&#125;&quot;)</span> <span class="hljs-comment">//获取key为mysql的配置</span><br>    <span class="hljs-keyword">private</span> String name;<br>    <span class="hljs-meta">@GetMapping(&quot;/mysql&quot;)</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> Object <span class="hljs-title">getapollo</span><span class="hljs-params">()</span></span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;mysql&quot;</span>+name;<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<ol start="2">
<li><h5 id="获取指定namespace的值"><a href="#获取指定namespace的值" class="headerlink" title="获取指定namespace的值"></a>获取指定namespace的值</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@RestController</span><br><span class="hljs-meta">@EnableApolloConfig(&quot;redis&quot;)</span>  <span class="hljs-comment">//指定namespace名称</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">redisController</span> </span>&#123;<br>    <span class="hljs-meta">@Value(&quot;$&#123;spring.redis.host&#125;&quot;)</span><br>    <span class="hljs-keyword">private</span> String redisHost;<br><br>    <span class="hljs-meta">@Value(&quot;$&#123;spring.redis.client-type&#125;&quot;)</span><br>    <span class="hljs-keyword">private</span> String redisType;<br><br>    <span class="hljs-meta">@GetMapping(&quot;/redis&quot;)</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> Object <span class="hljs-title">getRedis</span><span class="hljs-params">()</span></span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;redis连接地址： &quot;</span>+redisHost+<span class="hljs-string">&quot;redis类型： &quot;</span>+redisType;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

</li>
</ol>
<h4 id="2-使用bean注入的方式获取"><a href="#2-使用bean注入的方式获取" class="headerlink" title="2.使用bean注入的方式获取"></a>2.使用bean注入的方式获取</h4><ul>
<li>bean</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Component</span><br><span class="hljs-meta">@ConfigurationProperties(&quot;spring.redis&quot;)</span> <span class="hljs-comment">//添加之后自动识别此前缀下的配置</span><br><span class="hljs-meta">@Data</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ApolloConfig</span> </span>&#123;<br>    <span class="hljs-keyword">private</span> String host;  <span class="hljs-comment">//加上前缀对应配置中心的key</span><br>    <span class="hljs-keyword">private</span> String client_type;<br>&#125;<br><br></code></pre></td></tr></table></figure>

<ul>
<li><p>controller</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@RestController</span><br><span class="hljs-meta">@EnableApolloConfig(&quot;redis&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BeanController</span> </span>&#123;<br><br>    <span class="hljs-meta">@Autowired</span><br>    ApolloConfig apolloConfig;<br><br>    <span class="hljs-meta">@GetMapping(&quot;/redisBean&quot;)</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> Object <span class="hljs-title">getRedisBean</span><span class="hljs-params">()</span></span>&#123;<br>        <span class="hljs-keyword">return</span> apolloConfig;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
</li>
<li><h5 id="bean注入不会自动刷新，使用-RefreshScope注解"><a href="#bean注入不会自动刷新，使用-RefreshScope注解" class="headerlink" title="bean注入不会自动刷新，使用@RefreshScope注解"></a>bean注入不会自动刷新，使用@RefreshScope注解</h5><ul>
<li><pre><code class="xml"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span>
            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span>
            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-context<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span>
            <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.0.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span>
        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span>
<span class="comment"><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><br>- ##### 自动刷新配置类<br><br>  ```java<br>  <span class="hljs-meta">@Component</span><br>  <span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RefreshConfig</span> </span>&#123;<br>      <span class="hljs-meta">@Autowired</span><br>      ApolloConfig apolloConfig;<br>      <span class="hljs-meta">@Autowired</span><br>      RefreshScope refreshScope;<br>      <br>      <span class="hljs-meta">@ApolloConfigChangeListener(&#123;<span class="hljs-meta-string">&quot;redis&quot;</span>&#125;)</span><br>      <span class="hljs-keyword">public</span>  void  onChange(ConfigChangeEvent configChangeEvent)&#123;<br>          boolean configChange = <span class="hljs-literal">false</span>;<br>          <span class="hljs-keyword">for</span>(String cKey : configChangeEvent.changedKeys())&#123;<br>              <span class="hljs-keyword">if</span> (cKey.startsWith(<span class="hljs-string">&quot;spring.redis&quot;</span>))&#123;<br>                  configChange = <span class="hljs-literal">true</span>;<br>                  <span class="hljs-keyword">break</span>;<br>              &#125;<br>          &#125;<br>          <span class="hljs-keyword">if</span> (!configChange)&#123;<br>              <span class="hljs-keyword">return</span>;<br>          &#125;<br>          refreshScope.refresh(<span class="hljs-string">&quot;apolloConfig&quot;</span>);<br>      &#125;<br>  &#125;<br>  <br></code></pre></td></tr></table></figure></span></code></pre>
</li>
<li><h5 id="bean"><a href="#bean" class="headerlink" title="bean"></a>bean</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Component</span><br><span class="hljs-meta">@ConfigurationProperties(&quot;spring.redis&quot;)</span><br><span class="hljs-meta">@Data</span><br><span class="hljs-meta">@RefreshScope</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ApolloConfig</span> </span>&#123;<br>    <span class="hljs-keyword">private</span> String host;<br>    <span class="hljs-keyword">private</span> String client_type;<br>&#125;<br></code></pre></td></tr></table></figure>
</li>
<li><h5 id="目前会报错-还没找到原因，记录一下"><a href="#目前会报错-还没找到原因，记录一下" class="headerlink" title="目前会报错 还没找到原因，记录一下"></a>目前会报错 还没找到原因，记录一下</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs error">Servlet.service() for servlet [dispatcherServlet] in context with path [] threw exception [Request processing failed; nested exception is org.springframework.http.converter.HttpMessageConversionException: Type definition error: [simple type, class org.springframework.context.expression.StandardBeanExpressionResolver]; nested exception is com.fasterxml.jackson.databind.exc.InvalidDefinitionException: No serializer found for class org.springframework.context.expression.StandardBeanExpressionResolver and no properties discovered to create BeanSerializer (to avoid exception, disable SerializationFeature.FAIL_ON_EMPTY_BEANS) (through reference chain: com.project.project7.config.ApolloConfig$$EnhancerBySpringCGLIB$$7b737735[&quot;targetSource&quot;]-&gt;org.springframework.aop.target.SimpleBeanTargetSource[&quot;beanFactory&quot;]-&gt;org.springframework.beans.factory.support.DefaultListableBeanFactory[&quot;beanExpressionResolver&quot;])] with root cause<br><br></code></pre></td></tr></table></figure>

</li>
</ul>
</li>
</ul>
<h4 id="3-灰度发布"><a href="#3-灰度发布" class="headerlink" title="3.灰度发布"></a>3.灰度发布</h4><ul>
<li>获取方式也是用@value，跟一一样</li>
</ul>
<h2 id="5-Apollo的高可用"><a href="#5-Apollo的高可用" class="headerlink" title="5.Apollo的高可用"></a>5.Apollo的高可用</h2>
        </div>

        

        
            <div class="article-nav">
                
                    <div class="article-prev">
                        <a class="prev"
                           rel="prev"
                           href="/2021/03/16/OpenFeign-md/"
                        >
                            <span class="left arrow-icon flex-center">
                              <i class="fas fa-chevron-left"></i>
                            </span>
                            <span class="title flex-center">
                                <span class="post-nav-title-item">OpenFeign学习记录</span>
                                <span class="post-nav-item">Prev posts</span>
                            </span>
                        </a>
                    </div>
                
                
                    <div class="article-next">
                        <a class="next"
                           rel="next"
                           href="/2021/03/15/Linux-md/"
                        >
                            <span class="title flex-center">
                                <span class="post-nav-title-item">linux 学习记录</span>
                                <span class="post-nav-item">Next posts</span>
                            </span>
                            <span class="right arrow-icon flex-center">
                              <i class="fas fa-chevron-right"></i>
                            </span>
                        </a>
                    </div>
                
            </div>
        

        
    </div>
</div>


                
            </div>

        </div>

        <div class="page-main-content-bottom">
            <footer class="footer">
    <div class="info-container">
        <div class="copyright-info info-item">
            &copy;
            
              <span>2020</span>&nbsp;-&nbsp;
            
            2021&nbsp;<i class="fas fa-heart icon-animate"></i>&nbsp;<a href="/">周瑜</a>
        </div>
        
        <div class="theme-info info-item">
            Powered by <a target="_blank" href="https://hexo.io">Hexo</a>&nbsp;|&nbsp;Theme&nbsp;<a class="theme-version" target="_blank" href="https://github.com/XPoet/hexo-theme-keep">Keep v3.4.1</a>
        </div>
        
    </div>
</footer>

        </div>
    </div>

    
        <div class="post-tools">
            <div class="post-tools-container">
    <ul class="tools-list">
        <!-- TOC aside toggle -->
        

        <!-- go comment -->
        
    </ul>
</div>

        </div>
    

    <div class="right-bottom-side-tools">
        <div class="side-tools-container">
    <ul class="side-tools-list">
        <li class="tools-item tool-font-adjust-plus flex-center">
            <i class="fas fa-search-plus"></i>
        </li>

        <li class="tools-item tool-font-adjust-minus flex-center">
            <i class="fas fa-search-minus"></i>
        </li>

        <li class="tools-item tool-expand-width flex-center">
            <i class="fas fa-arrows-alt-h"></i>
        </li>

        <li class="tools-item tool-dark-light-toggle flex-center">
            <i class="fas fa-moon"></i>
        </li>

        <!-- rss -->
        

        

        <li class="tools-item tool-scroll-to-bottom flex-center">
            <i class="fas fa-arrow-down"></i>
        </li>
    </ul>

    <ul class="exposed-tools-list">
        <li class="tools-item tool-toggle-show flex-center">
            <i class="fas fa-cog fa-spin"></i>
        </li>
        
            <li class="tools-item tool-scroll-to-top flex-center">
                <i class="arrow-up fas fa-arrow-up"></i>
                <span class="percent"></span>
            </li>
        
    </ul>
</div>

    </div>

    

    <div class="image-viewer-container">
    <img src="">
</div>


    

</main>



<script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/header-shrink.js"></script><script src="/js/back2top.js"></script><script src="/js/dark-light-toggle.js"></script>







<div class="post-scripts">
    
</div>



<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"/live2dw/assets/wanko.model.json"},"display":{"position":"right","width":150,"height":300},"mobile":{"show":true},"react":{"opacity":0.7},"log":false});</script></body>
</html>
